<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rsat">
<title>1. Search • rsat</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="1. Search">
<meta property="og:description" content="rsat">
<meta property="og:image" content="https://docs.ropensci.org/rsat/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">rsat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.19</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/rsat1_search.html">1. Search</a>
    <a class="dropdown-item" href="../articles/rsat2_download.html">2. Download</a>
    <a class="dropdown-item" href="../articles/rsat3_customize.html">3. Customize</a>
    <a class="dropdown-item" href="../articles/rsat4_process.html">4. Process</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/rsat/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>1. Search</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/rsat/blob/HEAD/vignettes/rsat1_search.Rmd" class="external-link"><code>vignettes/rsat1_search.Rmd</code></a></small>
      <div class="d-none name"><code>rsat1_search.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="search">Search<a class="anchor" aria-label="anchor" href="#search"></a>
</h2>
<p>In <code>rsat</code>, <strong>searching</strong> means locating the satellite images of a desired data product for a given region and time of interest (referred to as <em>roi</em> and <em>toi</em> henceforth). Searching requires <strong>getting access</strong> to satellite imagery and <strong>doing a search</strong> (Section 2), i.e. finding, previewing, and filtering the available information for a <em>roi</em> and <em>toi</em>.</p>
<hr>
<div class="section level3">
<h3 id="Getting-access">Getting access<a class="anchor" aria-label="anchor" href="#Getting-access"></a>
</h3>
<div class="section level4">
<h4 id="profiles">Profiles<a class="anchor" aria-label="anchor" href="#profiles"></a>
</h4>
<p><code>rsat</code> communicates with two public data archives through their <em>Application Programming Interfaces</em> (<em>APIs</em>). The registration in the following online portals is required to get a full access to satellite images with <code>rsat</code>;</p>
<ul>
<li>
<a href="https://ers.cr.usgs.gov/register/" class="external-link">USGS</a> USGS is the sole science agency for the Department of the Interior of United States. Provide access to Modis Images. More information about USGS can be found <a href="https://www.usgs.gov/" class="external-link">Here</a>.</li>
<li>
<a href="https://urs.earthdata.nasa.gov" class="external-link">EarthData</a>: A repository of NASA’s earth observation data-sets. More information about EarthData can be found <a href="https://www.earthdata.nasa.gov/learn" class="external-link">here</a>.</li>
<li>
<a href="https://scihub.copernicus.eu/dhus/#/self-registration" class="external-link">SciHub</a>, a web service giving access to Copernicus’ scientific data hub. Please go <a href="https://scihub.copernicus.eu/" class="external-link">here</a> to find more details about the data hub.</li>
</ul>
<p>For convenience, try to use the same <em>username</em> and <em>password</em> for all of them. To satisfy the criteria in both web services make sure that the <u><em>username</em> is <span class="math inline">\(4\)</span> characters long and includes a period, number or underscore</u>. The <u><em>password</em> must be <span class="math inline">\(12\)</span> character long and should include characters with at least one capital letter, and numbers</u>.</p>
</div>
<div class="section level4">
<h4 id="credentials-management">Credentials management<a class="anchor" aria-label="anchor" href="#credentials-management"></a>
</h4>
<p>Two functions deal with the <em>usernames</em> and <em>passwords</em> for the various <em>APIs</em> considered in <code>rsat</code>; <code><a href="../reference/set_credentials.html">set_credentials()</a></code> and <code><a href="../reference/print_credentials.html">print_credentials()</a></code><em>.</em> The former defines which <code>username</code> (first argument) and <code>password</code> (second argument) should be used for which <code>portal</code> (third argument):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rsat">rsat</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/set_credentials.html">set_credentials</a></span><span class="op">(</span><span class="st">"rsat.package"</span>,<span class="st">"UpnaSSG.2021"</span>, <span class="st">"scihub"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/set_credentials.html">set_credentials</a></span><span class="op">(</span><span class="st">"rsat.package"</span>,<span class="st">"UpnaSSG.2021"</span>, <span class="st">"earthdata"</span><span class="op">)</span></span></code></pre></div>
<p>The latter prints the <em>usernames</em> and <em>passwords</em> saved during the current <code>R</code> session:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/print_credentials.html">print_credentials</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>If <em>usernames</em> and <em>passwords</em> are the same for all the portals, they can be set with a single instruction:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_credentials.html">set_credentials</a></span><span class="op">(</span><span class="st">"rsat.package"</span>,<span class="st">"UpnaSSG.2021"</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="Doing-a-search">Doing a search<a class="anchor" aria-label="anchor" href="#Doing-a-search"></a>
</h3>
<div class="section level4">
<h4 id="simple-search">Simple search<a class="anchor" aria-label="anchor" href="#simple-search"></a>
</h4>
<div class="section level5">
<h5 id="finding-data-records">Finding data records<a class="anchor" aria-label="anchor" href="#finding-data-records"></a>
</h5>
<p>The function <code><a href="../reference/rsat_search.html">rsat_search()</a></code> performs the search of satellite imagery. One way to use this function is providing; (1) a geo-referenced polygon (<code>sf</code> class object), (2) the initial and final dates of the relevant time period (<code>date</code> vector), and (3) the name(s) of the satellite data product(s) (<code>character</code> vector). <code>rsat</code> gives access to several satellite data products. Among them, the <em>surface reflectance</em> products are frequently used in applied research studies. Their names are:</p>
<ul>
<li>
<p>for the Landsat program:</p>
<ul>
<li>Landsat 4-5 mission: <code>"LANDSAT_TM_C1"</code>
</li>
<li>Landsat-7 mission: <code>"LANDSAT_ETM_C1"</code>
</li>
<li>Landsat-8 mission: <code>"LANDSAT_8_C1"</code>
</li>
</ul>
</li>
<li>
<p>for the MODIS program:</p>
<ul>
<li>Terra satellite: <code>"mod09ga"</code>
</li>
<li>Aqua satellite: <code>"myd09ga"</code>
</li>
</ul>
</li>
<li>
<p>for the Sentinel program:</p>
<ul>
<li><p>Sentinel-2 mission: <code>"S2MSI2A"</code></p></li>
<li><p>Sentinel-3 mission: <code>"SY_2_SYN___"</code></p></li>
</ul>
</li>
</ul>
<p>More details about other products and their names can be found <a href="https://www.usgs.gov/landsat-missions/product-information" class="external-link">here</a>, <a href="https://modis.gsfc.nasa.gov/data/dataprod/" class="external-link">here</a>, and <a href="https://sentinel.esa.int/web/sentinel/missions" class="external-link">here</a> for Landsat, MODIS, and Sentinel respectively. The package can search and download other data than multispectral images (e.g., radar) although this goes beyond the scope of the current status of the package.</p>
<p>The following code looks for satellite images (<em>surface reflectance</em>) of a region in norther Spain captured during the first half of January <span class="math inline">\(2021\)</span>, captured by MODIS:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ex.navarre"</span><span class="op">)</span></span>
<span><span class="va">toi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-01-01"</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0</span><span class="op">:</span><span class="fl">15</span></span>
<span><span class="va">rcd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rsat_search.html">rsat_search</a></span><span class="op">(</span>region <span class="op">=</span> <span class="va">ex.navarre</span>,</span>
<span>                   product <span class="op">=</span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="st">"mod09ga"</span><span class="op">)</span>,</span>
<span>                   dates <span class="op">=</span> <span class="va">toi</span><span class="op">)</span></span></code></pre></div>
<p>A search can involve several products simultaneously. In addition to MODIS, the instruction below also considers images from Sentinel-3:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rcd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rsat_search.html">rsat_search</a></span><span class="op">(</span>region <span class="op">=</span> <span class="va">ex.navarre</span>,</span>
<span>                   product <span class="op">=</span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="st">"mod09ga"</span>, <span class="st">"SY_2_SYN___"</span><span class="op">)</span>,</span>
<span>                   dates <span class="op">=</span> <span class="va">toi</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">rcd</span><span class="op">)</span></span></code></pre></div>
<p>The output from <code><a href="../reference/rsat_search.html">rsat_search()</a></code> is a <code>records</code> object. This object stores the search results metadata from the various <em>APIs</em> in standardized manner. A <code>records</code> works as a vector and every element of the vector refers to an image. Information about an image is saved in the following <em>slots</em>:</p>
<ul>
<li>sat (<code>character</code>): name of the satellite (e.g., Landsat, MODIS, Sentinel-2, Sentinel-3, etc.).</li>
<li>name (<code>character</code>): name of the file.</li>
<li>date (<code>Date</code>): capturing date of the image.</li>
<li>product (<code>character</code>): name of the data product.</li>
<li>path (<code>numeric</code>): horizontal location of the tile (MODIS/Landsat only).</li>
<li>row (<code>numeric</code>): vertical location of the tile (MODIS/Landsat only).</li>
<li>tileid (<code>character</code>): tile identification number (Sentinel only).</li>
<li>download (<code>character</code>): download URL.</li>
<li>file_path (<code>character</code>): the relative path for local store of the image.</li>
<li>preview (<code>character</code>): preview URL.</li>
<li>api_name (<code>character</code>): name of the API internally used by <code>rsat</code>.</li>
<li>order (<code>boolean</code>): if <code>TRUE</code>, the image needs to be ordered before the download.</li>
<li>extent_crs (<code>extent_crs</code>): coordinate reference system of the preview.</li>
</ul>
<p>You can extract the most relevant <em>slots</em> from a <code>records</code> using specific functions such as <code><a href="../reference/sat_name.html">sat_name()</a></code>, <code><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names()</a></code>, or <code><a href="../reference/dates.html">dates()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="../reference/sat_name.html">sat_name</a></span><span class="op">(</span><span class="va">rcd</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">rcd</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="../reference/dates.html">dates</a></span><span class="op">(</span><span class="va">rcd</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="filtering-search-results">Filtering search results<a class="anchor" aria-label="anchor" href="#filtering-search-results"></a>
</h4>
<p>As mentioned earlier, a <code>records</code> object behaves like a vector. It works with common <code>R</code> methods such as <code><a href="../reference/c.html">c()</a></code>, <code>[]</code>, <code><a href="https://rdrr.io/r/base/length.html" class="external-link">length()</a></code>, <code><a href="https://rspatial.github.io/terra/reference/subset.html" class="external-link">subset()</a></code>, or <code><a href="../reference/unique.html">unique()</a></code>. These methods allow to filter and tinker with the search results. Selecting and filtering satellite images is specially powerful when combined with visualization (see below). Discarding useless images at this stage of the process can save memory space and processing time.</p>
<p>For instance, the code below counts the results found from each mission:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod.rcd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">rcd</span>, <span class="st">"sat"</span>, <span class="st">"Modis"</span><span class="op">)</span></span>
<span><span class="va">sn3.rcd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">rcd</span>, <span class="st">"sat"</span>, <span class="st">"Sentinel-3"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mod.rcd</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sn3.rcd</span><span class="op">)</span></span></code></pre></div>
<p>The first, second, and third argument in <code><a href="https://rspatial.github.io/terra/reference/subset.html" class="external-link">subset()</a></code> correspond to, (1) the <code>records</code> object, (2) the name of the slot used for subsetting, and (3) the value of the slot we are interested in. The next lines of code show a more advance filtering example where a new <code>records</code> is built from images captured by both missions on the same dates:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod.mtch</span> <span class="op">&lt;-</span> <span class="va">mod.rcd</span><span class="op">[</span><span class="fu"><a href="../reference/dates.html">dates</a></span><span class="op">(</span><span class="va">mod.rcd</span><span class="op">)</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="../reference/dates.html">dates</a></span><span class="op">(</span><span class="va">sn3.rcd</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">sn3.mtch</span> <span class="op">&lt;-</span> <span class="va">sn3.rcd</span><span class="op">[</span><span class="fu"><a href="../reference/dates.html">dates</a></span><span class="op">(</span><span class="va">sn3.rcd</span><span class="op">)</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="../reference/dates.html">dates</a></span><span class="op">(</span><span class="va">mod.rcd</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">rcd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="va">mod.mtch</span>, <span class="va">sn3.mtch</span><span class="op">)</span></span></code></pre></div>
<p>A <code>records</code> can be coerced to a <code>data.frame</code> with <code><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame()</a></code> and transformed back with <code><a href="../reference/as.records.html">as.records()</a></code>. The rows and columns of the <code>data.frame</code> correspond to the satellite images and their slots respectively:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rcd.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">rcd</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">rcd.df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">rcd.df</span><span class="op">)</span></span>
<span><span class="co"># rcd &lt;- as.records(rcd.df)</span></span>
<span><span class="co"># class(rcd)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="previewing-search-results">Previewing search results<a class="anchor" aria-label="anchor" href="#previewing-search-results"></a>
</h4>
<p>The <code>rsat</code> package provides a <code><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot()</a></code> method for satellite <code>records</code>. It displays a preview of the satellite images, i.e a low-resolution versions of the satellite images. Previewing can help to decide whether the actual image, much heavier than the preview, is worth downloading.</p>
<p>Cloudy images are frequently useless and they can be removed from the <code>records</code> object using vector-like methods (see previous section). For instance, the code below displays the first <span class="math inline">\(10\)</span> records and, based on visual evaluation of cloud coverage, it removes the <span class="math inline">\(9^{th}\)</span> image from the <code>records</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prview</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rcd</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">prview</span></span>
<span><span class="va">rcd</span> <span class="op">&lt;-</span> <span class="va">rcd</span><span class="op">[</span><span class="op">-</span><span class="fl">9</span><span class="op">]</span></span></code></pre></div>
<p>Sometimes, it might be difficult to spot the location of the region of interest on the previews. The <em>roi</em> polygon can be passed to the <code><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot()</a></code> function using the <code>region</code> argument. Additionally, the <code><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot()</a></code> method in <code>rsat</code> is a wrapper function of <code>tmap</code> and it accepts other inputs from <code>tm_raster()</code> and <code>tm_polygon()</code>. These arguments should be preceded by the <code>tm.raster</code> and <code>tm.polygon</code> identifiers.</p>
<p>The instruction below leverages the preview to its fullest. It shows the <em>RGB</em> satellite image preview with the <em>roi</em> superposed (), with a red border color (<code>tm.polygon.region.border.col = "red"</code>) and no fill (<code>tm.polygon.region.alpha = 0</code>). The compass (<code>compass.rm = TRUE</code>) and scale bar (<code>scale.bar.rm = TRUE</code>) are removed:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rcd</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>,</span>
<span>     region <span class="op">=</span> <span class="va">ex.navarre</span>,</span>
<span>     tm.polygon.region.border.col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>     tm.polygon.region.alpha <span class="op">=</span> <span class="fl">0</span>,</span>
<span>     compass.rm <span class="op">=</span> <span class="cn">T</span>,</span>
<span>     scale.bar.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="advanced-search">Advanced search<a class="anchor" aria-label="anchor" href="#advanced-search"></a>
</h3>
<div class="section level4">
<h4 id="the-rtoi">The <code>rtoi</code><a class="anchor" aria-label="anchor" href="#the-rtoi"></a>
</h4>
<p>Sometimes, regions are located at the intersection of images or they are too large to fit in a single scene. In these situations, working with separate files might be cumbersome. As a solution, <code>rsat</code> provides the <code>rtoi</code> class object. An <code>rtoi</code> is a project or study-case which is associated with a <em>region and time of interest</em> (hence its name). An <code>rtoi</code> consists of the following elements:</p>
<ol style="list-style-type: decimal">
<li>
<code>name</code>: a project identifier.</li>
<li>
<code>region</code>: a georeferenced polygon (<code>sf</code> class object).</li>
<li>
<code>db_path</code>: the path to a database, i.e. a folder for raw satellite images which have generic purposes.</li>
<li>
<code>rtoi_path</code>: the path to a dataset, i.e. a folder for customized/processed.</li>
<li>
<code>records</code>: a vector of satellite records relevant for the study.</li>
</ol>
<p>As a showcase, we’ll assess the effects of the <a href="https://en.wikipedia.org/wiki/2020%E2%80%9321_European_windstorm_season#Storm_Filomena" class="external-link">Storm Filomena</a> over the Iberian peninsula in terms of snow coverage. The storm was an extreme meteorological event (largest since 1971, according to <a href="http://www.aemet.es/en/portada" class="external-link"><em>AEMET</em></a>). The storm swept the peninsula from January <span class="math inline">\(6^{th}\)</span> and <span class="math inline">\(11^{th}\)</span>, <span class="math inline">\(2021\)</span>. The code below generates a bounding box around the peninsula (<code>ip</code>) and limits the study period (<code>toi</code>) to the immediate dates after the storm:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ip</span> <span class="op">&lt;-</span> <span class="fu">st_sf</span><span class="op">(</span><span class="fu">st_as_sfc</span><span class="op">(</span><span class="fu">st_bbox</span><span class="op">(</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span></span>
<span>  xmin <span class="op">=</span> <span class="op">-</span><span class="fl">9.755859</span>,</span>
<span>  xmax <span class="op">=</span>  <span class="fl">4.746094</span>,</span>
<span>  ymin <span class="op">=</span> <span class="fl">35.91557</span>,</span>
<span>  ymax <span class="op">=</span> <span class="fl">44.02201</span> </span>
<span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">toi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-01-10"</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-01-15"</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>A new <code>rtoi</code> requires at least the elements from <span class="math inline">\(1\)</span> to <span class="math inline">\(4\)</span>. The following lines generate programmatically the database and dataset folders:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db.path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"database"</span><span class="op">)</span></span>
<span><span class="va">ds.path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"datasets"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">db.path</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">ds.path</span><span class="op">)</span></span></code></pre></div>
<p>The function <code><a href="../reference/new_rtoi.html">new_rtoi()</a></code> builds a new <code>rtoi</code> from the elements mentioned above:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filomena</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_rtoi.html">new_rtoi</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"filomena"</span>,</span>
<span>                     region <span class="op">=</span> <span class="va">ip</span>,</span>
<span>                     db_path <span class="op">=</span> <span class="va">db.path</span>,</span>
<span>                     rtoi_path <span class="op">=</span> <span class="va">ds.path</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/new_rtoi.html">new_rtoi()</a></code> function writes a set of files representing a copy of the <code>R</code> object (filomena.rtoi) and a shapefile of the <em>roi</em> (region):</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rtoi.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">ds.path</span>, <span class="st">"filomena"</span><span class="op">)</span>, full.name <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">rtoi.files</span></span></code></pre></div>
<p>This file is updated whenever the <code>rtoi</code> is modified. Thus, if the <code>R</code> session accidentally breaks or closes, the last version of the <code>rtoi</code> is saved in you hard drive and can be loaded with <code><a href="../reference/read_rtoi.html">read_rtoi()</a></code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filomena</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_rtoi.html">read_rtoi</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">ds.path</span>, <span class="st">"filomena"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Printing the <code>rtoi</code> provides a summary about the region and time of interest, a summary of the relevant <code>records</code> for the analysis, and the paths to the database and the dataset:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">filomena</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="search-with-an-rtoi">Search with an <code>rtoi</code><a class="anchor" aria-label="anchor" href="#search-with-an-rtoi"></a>
</h4>
<p>You can use an <code>rtoi</code> to search satellite images with <code><a href="../reference/rsat_search.html">rsat_search()</a></code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">toi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-01-10"</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0</span><span class="op">:</span><span class="fl">5</span></span>
<span><span class="fu"><a href="../reference/rsat_search.html">rsat_search</a></span><span class="op">(</span>region <span class="op">=</span> <span class="va">filomena</span>,</span>
<span>            product <span class="op">=</span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="st">"mod09ga"</span>, <span class="st">"SY_2_SYN___"</span><span class="op">)</span>,</span>
<span>            dates <span class="op">=</span> <span class="va">toi</span><span class="op">)</span></span></code></pre></div>
<p>An <code>rtoi</code> is an S6 class object, so it behaves like any object in other programming languages. That is, if the <code>rtoi</code> is passed as an argument and modifies the <code>rtoi</code>, the object in the main environment is also updated. The function <code><a href="../reference/rsat_search.html">rsat_search()</a></code> places the resulting <code>records</code> into the <code>rtoi</code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">filomena</span><span class="op">)</span></span></code></pre></div>
<p>Since the <code>rtoi</code> has been modified, the <code>rtoi.file</code> has also been updated:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.info</a></span><span class="op">(</span><span class="va">rtoi.files</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">ctime</span> <span class="co"># creation time</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.info</a></span><span class="op">(</span><span class="va">rtoi.files</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">mtime</span> <span class="co"># modification time</span></span></code></pre></div>
<p>To extract the <code>records</code> from the <code>rtoi</code> use <code><a href="../reference/records.html">records()</a></code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rcds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/records.html">records</a></span><span class="op">(</span><span class="va">filomena</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">rcds</span><span class="op">)</span></span></code></pre></div>
<p>If you want to apply further filters on the results, as shown in the previous section, you need to extract the <code>records</code> from the <code>rtoi</code> first and then apply <code><a href="../reference/c.html">c()</a></code>, <code>[]</code>, <code><a href="https://rspatial.github.io/terra/reference/subset.html" class="external-link">subset()</a></code>, and <code><a href="https://rdrr.io/r/base/length.html" class="external-link">length()</a></code> at your convenience.</p>
</div>
<div class="section level4">
<h4 id="displaying-results">Displaying results<a class="anchor" aria-label="anchor" href="#displaying-results"></a>
</h4>
<p>There is a <code><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot()</a></code> method too for <code>rtoi</code>s but it is more sophisticated. There is a <code>"preview"</code> mode that shows the low-resolution <em>RGB</em> version of the satellite images. The plot binds together the satellite images available for a given date and <code>roi</code>, and the function allows other arguments, such as <code>product</code> or <code>dates</code>, to better select the information being shown:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">filomena</span>,</span>
<span>     <span class="st">"preview"</span>,</span>
<span>     product <span class="op">=</span> <span class="st">"mod09ga"</span>,</span>
<span>     dates <span class="op">=</span> <span class="st">"2021-01-11"</span><span class="op">)</span></span></code></pre></div>
<p><code>rtoi</code>s are designed save information from several missions. The <code>mode = "dates"</code> prints a calendar indicating the availability of satellite images from one or multiple missions during the time of interest:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">filomena</span>, <span class="st">"dates"</span><span class="op">)</span></span></code></pre></div>
<p>The following vignette explains how to download the satellite images and the role of the <em>database</em> when managing multiple <code>rtoi</code>s. To reduce the processing times and memory space, the showcase is restricted to MODIS images from here onward:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rcd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/records.html">records</a></span><span class="op">(</span><span class="va">filomena</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/records.html">records</a></span><span class="op">(</span><span class="va">filomena</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">rcd</span>, <span class="st">"product"</span>, <span class="st">"mod09ga"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
