<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rsat">
<title>4. Process • rsat</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="4. Process">
<meta property="og:description" content="rsat">
<meta property="og:image" content="https://docs.ropensci.org/rsat/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">rsat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.19</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/rsat1_search.html">1. Search</a>
    <a class="dropdown-item" href="../articles/rsat2_download.html">2. Download</a>
    <a class="dropdown-item" href="../articles/rsat3_customize.html">3. Customize</a>
    <a class="dropdown-item" href="../articles/rsat4_process.html">4. Process</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/rsat/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>4. Process</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/rsat/blob/HEAD/vignettes/rsat4_process.Rmd" class="external-link"><code>vignettes/rsat4_process.Rmd</code></a></small>
      <div class="d-none name"><code>rsat4_process.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="processing">Processing<a class="anchor" aria-label="anchor" href="#processing"></a>
</h2>
<p>Processing encapsulates the operations applied to satellite images to solve particular issues derived from errors, anomalies or discrepancies from sensors. For instance, cloud removal or sensor failures can lead to data gaps in time-series of satellite images. Additionally, noise from aerosols, dust, and sensor measurement errors can reduce the quality of the remotely sensed data. The <strong><em>Interpolation of Mean Anomalies (IMA</em></strong>) is a gap-filling and smoothing approach that mitigates these issues <span class="citation">(Militino et al. 2019)</span>.</p>
<div class="section level4">
<h4 id="filling">Filling missing data<a class="anchor" aria-label="anchor" href="#filling"></a>
</h4>
<div class="section level5">
<h5 id="theoretical-background">Theoretical background<a class="anchor" aria-label="anchor" href="#theoretical-background"></a>
</h5>
<p><code>rsat</code> implements a generic version of the algorithm with the function <code>smoothing_image()</code>.</p>
<div class="figure">
<img src="images/neighborhood_ima.png" title="Neighborhood defintion in IMA" width="456" alt=""><p class="caption">Neighborhood definition in the Interpolation of Mean Anomalies, assuming <code>nDays = 1</code> and <code>nYears = 1</code></p>
</div>
<p>For the theoretical explanation, let’s assume that <span class="math inline">\(15\)</span> images are available in the dataset (squares in the image above). The imagery corresponds to <span class="math inline">\(5\)</span> consecutive days over <span class="math inline">\(3\)</span> years. Consider that we are willing to fill/smooth the target image (red square). <em>IMA</em> fills the gaps borrowing information from an <em>adaptable</em> temporal neighborhood (yellow squares). Two parameters determine the size of the neighborhood; the number of days before and after the target image (<code>nDays</code>) and the number of previous and subsequent years (<code>nYears</code>). Both parameters should be adjusted based on the temporal resolution of the of the time-series of images. We recommend that the neighborhood extends over days rather than years, when there is little resemblance between seasons. Also, cloudy series may require larger neighborhoods.</p>
<div class="figure">
<img src="images/ima_technique.png" title="IMA summarized algorithm" alt=""><p class="caption">Summarized algorithm of the Interpolation of Mean Anomalies</p>
</div>
<p><em>IMA</em> gives the following steps; (1) creates a representative image of the neighborhood ignoring missing values e.g., doing the mean, median, etc. for each pixel’s time-series (<code>fun</code>), (2) the target and representative images are subtracted giving an image of <em>anomalies</em>, (3) the <em>anomalies</em> falling outside the quantile limits (<code>aFilter</code>) are considered outliers and therefore removed, (4) it aggregates the anomaly image into a coarser resolution (<code>fact</code>) to reveal potential spatial dependencies, (5) the procedure fits a spatial model (thin plate splines or <em>TPS</em>) to the anomalies which is then used to interpolate the values at the original resolution, and (6) the output is the sum of the interpolated anomalies and the average image. The process is encapsulated in <code>smoothing_image()</code> and the section below shows its usage.</p>
<hr>
</div>
<div class="section level5">
<h5 id="hands-on-demonstration">Hands-on demonstration<a class="anchor" aria-label="anchor" href="#hands-on-demonstration"></a>
</h5>
<div class="section level6">
<h6 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h6>
<p>The showcase uses a time-series of <span class="math inline">\(6\)</span> <em>NDVI</em> images. <em>NDVI</em> stands for <em>Normalized Difference Vegetation Index</em> and it is an indicator of vegetation’s vigor. Values close to <span class="math inline">\(1\)</span> indicate the presence of green and dense vegetation. Images correspond to a region in norther Spain between August <span class="math inline">\(2^{nd}\)</span> and <span class="math inline">\(4^{th}\)</span>, in <span class="math inline">\(2017\)</span> and <span class="math inline">\(2018\)</span>. The images are part of the package and can be loaded into the environment as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rsat">rsat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ex.ndvi.navarre"</span><span class="op">)</span></span>
<span><span class="va">ex.ndvi.navarre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ex.ndvi.navarre</span><span class="op">)</span></span></code></pre></div>
<p>Let’s display the series of images to spot the gaps of data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-tmap.github.io/tmap/" class="external-link">tmap</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">ex.ndvi.navarre</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_raster.html" class="external-link">tm_raster</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NDVI"</span>, style <span class="op">=</span> <span class="st">"cont"</span><span class="op">)</span></span></code></pre></div>
<p>The maps show a hole on August <span class="math inline">\(3^{rd}\)</span>, <span class="math inline">\(2017\)</span> in the upper part of the image. The aim of <em>IMA</em> is to predict the values of the missing parts to provide a complete and continuous dataset.</p>
</div>
<div class="section level6">
<h6 id="interpolation-of-mean-anomalies">Interpolation of Mean Anomalies<a class="anchor" aria-label="anchor" href="#interpolation-of-mean-anomalies"></a>
</h6>
<p>The instruction below applies the <em>IMA</em> to the entire series. It uses a temporal neighborhood of <span class="math inline">\(2\)</span> days and <span class="math inline">\(1\)</span> year and the representative image is the <code>mean</code>. Outliers are the anomalies outside <span class="math inline">\(1-99\)</span> quantile range. Anomalies are aggregated at a factor of <span class="math inline">\(10\)</span> (every <span class="math inline">\(10\)</span> pixels are aggregated into <span class="math inline">\(1\)</span>) to fit an approximate spatial model. We recommend to tune the parameters accordingly to obtain the best performance possible in each situation:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rsat">rsat</a></span><span class="op">)</span></span>
<span><span class="va">ndvi.fill</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rsat_smoothing_images.html">rsat_smoothing_images</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"IMA"</span>,</span>
<span>                                   <span class="va">ex.ndvi.navarre</span>,</span>
<span>                                   nDays <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                   nYears <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                   fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>                                   aFilter <span class="op">=</span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.99</span><span class="op">)</span>,</span>
<span>                                   fact <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                                   only.na <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The algorithm predicts the value for the missing and the existing pixels. The last argument, <code>only.na = TRUE</code>, indicates that the results should preserve the original values wherever available. <em>IMA</em> is able to run when neighborhoods are incomplete. In those situations, the algorithm simply uses the imagery available within the temporal neighborhood. The function prints a message specifying the actual number of images being used in each case.</p>
<p>Let’s make a comparison between <em>before</em> and <em>after</em> the application of <em>IMA.</em></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">before</span> <span class="op">&lt;-</span> <span class="va">ex.ndvi.navarre</span><span class="op">[[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">after</span> <span class="op">&lt;-</span> <span class="va">ndvi.fill</span><span class="op">[[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="va">before</span>,<span class="va">after</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_raster.html" class="external-link">tm_raster</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NDVI"</span>, style <span class="op">=</span> <span class="st">"cont"</span><span class="op">)</span></span></code></pre></div>
<p>The intention is to keep growing the number of algorithms devoted to processing in future versions of the package.</p>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-militino2019interpolation" class="csl-entry">
Militino, A F, M D Ugarte, U Perez-Goya, and Marc G. Genton. 2019. <span>“Interpolation of the Mean Anomalies for Cloud-Filling in Land Surface Temperature (LST) and Normalized Difference Vegetation Index (NDVI).”</span> <em>IEEE Transactions on Geoscience and Remote Sensing. (Open-Access)</em>. <a href="http://dx.doi.org/10.1109/TGRS.2019.2904193" class="external-link">http://dx.doi.org/10.1109/TGRS.2019.2904193</a>.
</div>
</div>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
